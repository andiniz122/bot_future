<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard Pro v6.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #1a1f2e;
            --bg-card: #242937;
            --bg-hover: #2a2f3e;
            --accent-green: #00ff88;
            --accent-red: #ff4757;
            --accent-blue: #3742fa;
            --accent-gold: #ffd700;
            --text-primary: #ffffff;
            --text-secondary: #a0a6b8;
            --border-color: #3a3f4e;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            --gradient-danger: linear-gradient(135deg, #ff4757 0%, #cc3644 100%);
            --gradient-warning: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1rem;
            position: fixed;
            height: 100vh;
            width: 280px;
            overflow-y: auto;
            z-index: 1000;
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .logo h1 {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo .version {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--bg-hover);
            color: var(--text-primary);
            transform: translateX(5px);
        }

        .nav-link i {
            margin-right: 0.75rem;
            width: 20px;
        }

        .nav-link.active {
            background: var(--gradient-primary);
            color: white;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            background: var(--bg-primary);
        }

        .header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .header-title {
            font-size: 2rem;
            font-weight: bold;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: 20px;
            border: 1px solid var(--border-color);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-dot.offline {
            background: var(--accent-red);
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-blue);
            box-shadow: 0 12px 48px rgba(55, 66, 250, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .card-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .change-positive {
            color: var(--accent-green);
        }

        .change-negative {
            color: var(--accent-red);
        }

        /* Trading Bot Status Card */
        .bot-status-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            position: relative;
        }

        .bot-status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-success);
            border-radius: 16px 16px 0 0;
        }

        .bot-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Chart Container */
        .chart-container {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .period-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .period-btn.active, .period-btn:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        /* Sentiment Cards */
        .sentiment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .sentiment-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .sentiment-gauge {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            position: relative;
        }

        .gauge-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                var(--accent-red) 0deg 72deg,
                var(--accent-gold) 72deg 144deg,
                var(--accent-green) 144deg 216deg
            );
            position: relative;
        }

        .gauge-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            background: var(--bg-card);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .gauge-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .gauge-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Real-time Data Indicators */
        .realtime-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .realtime-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-green);
        }

        /* Alerts Section */
        .alerts-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--accent-blue);
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            background: var(--bg-hover);
        }

        .alert-item.high {
            border-left-color: var(--accent-red);
        }

        .alert-item.medium {
            border-left-color: var(--accent-gold);
        }

        .alert-item.low {
            border-left-color: var(--accent-green);
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-card);
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alert-message {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .alert-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: fixed;
                left: -280px;
                transition: left 0.3s ease;
                z-index: 1000;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .header-controls {
                justify-content: center;
            }
            
            .chart-wrapper {
                height: 300px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--accent-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            z-index: 1000;
        }

        /* Hide sections by default */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* WebSocket Status Indicators */
        .ws-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .ws-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-red);
        }

        .ws-indicator.connected {
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <h1><i class="fas fa-chart-line"></i> Trading Pro</h1>
                <div class="version">v6.0 - Real Data</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="overview">
                        <i class="fas fa-tachometer-alt"></i>
                        Overview
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="markets">
                        <i class="fas fa-chart-candlestick"></i>
                        Mercados
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="bot">
                        <i class="fas fa-robot"></i>
                        Trading Bot
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="sentiment">
                        <i class="fas fa-brain"></i>
                        Sentimento
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="calendar">
                        <i class="fas fa-calendar-alt"></i>
                        Calendário FRED
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="alerts">
                        <i class="fas fa-bell"></i>
                        Alertas
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="analytics">
                        <i class="fas fa-chart-pie"></i>
                        Analytics
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div>
                    <h1 class="header-title">Trading Dashboard Pro</h1>
                    <div class="realtime-indicator">
                        <div class="realtime-dot"></div>
                        Dados em Tempo Real
                    </div>
                </div>
                <div class="header-controls">
                    <div class="status-indicator">
                        <div class="status-dot" id="apiStatus"></div>
                        <span id="apiStatusText">Conectando...</span>
                    </div>
                    <div class="ws-status">
                        <div class="ws-indicator" id="wsIndicator"></div>
                        <span id="wsStatusText">WebSocket</span>
                    </div>
                    <button class="btn btn-primary" onclick="refreshAllData()">
                        <i class="fas fa-sync-alt"></i>
                        Atualizar
                    </button>
                </div>
            </header>

            <!-- Overview Section -->
            <section id="overview" class="content-section active">
                <div class="cards-grid">
                    <!-- Market Cards -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Bitcoin (BTC)</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #ff8c00, #ff6b47);">
                                <i class="fab fa-bitcoin"></i>
                            </div>
                        </div>
                        <div class="card-value" id="btcPrice">$0</div>
                        <div class="card-change" id="btcSentimentTrend">
                            <span>Tendência: Neutral</span>
                        </div>
                    </div>

                    <div class="sentiment-card">
                        <h3>Fear & Greed Index</h3>
                        <div class="sentiment-gauge">
                            <div class="gauge-circle">
                                <div class="gauge-inner">
                                    <div class="gauge-value" id="fearGreedValue">50</div>
                                    <div class="gauge-label">Index</div>
                                </div>
                            </div>
                        </div>
                        <div class="card-change" id="marketMood">
                            <span>Humor: Neutro</span>
                        </div>
                    </div>

                    <div class="sentiment-card">
                        <h3>PAXG Sentiment</h3>
                        <div class="sentiment-gauge">
                            <div class="gauge-circle">
                                <div class="gauge-inner">
                                    <div class="gauge-value" id="paxgSentimentValue">50</div>
                                    <div class="gauge-label">Buyers %</div>
                                </div>
                            </div>
                        </div>
                        <div class="card-change" id="paxgSentimentTrend">
                            <span>Tendência: Neutral</span>
                        </div>
                    </div>
                </div>

                <!-- Sentiment History Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Histórico de Sentimento (24h)</h3>
                        <div class="realtime-indicator">
                            <div class="realtime-dot"></div>
                            Atualização Automática
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="sentimentChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Calendar Section -->
            <section id="calendar" class="content-section">
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Eventos Hoje</span>
                            <div class="card-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                        </div>
                        <div class="card-value" id="eventsToday">0</div>
                        <div class="card-change" id="highImpactToday">
                            <span>Alto Impacto: 0</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Próximos Eventos</span>
                            <div class="card-icon" style="background: var(--gradient-warning);">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="card-value" id="upcomingEvents">0</div>
                        <div class="card-change" id="nextCritical">
                            <span>Próximo Crítico: N/A</span>
                        </div>
                    </div>
                </div>

                <!-- Economic Events List -->
                <div class="alerts-section">
                    <div class="alerts-header">
                        <h3><i class="fas fa-calendar-alt"></i> Calendário Econômico FRED</h3>
                        <div class="realtime-indicator">
                            <div class="realtime-dot"></div>
                            FRED API Ativa
                        </div>
                    </div>
                    <div id="economicEvents">
                        <div class="alert-item">
                            <div class="alert-content">
                                <div class="alert-title">Carregando eventos econômicos...</div>
                                <div class="alert-message">Aguarde enquanto buscamos os dados do FRED...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alerts Section -->
            <section id="alerts" class="content-section">
                <div class="alerts-section">
                    <div class="alerts-header">
                        <h3><i class="fas fa-bell"></i> Sistema de Alertas</h3>
                        <div class="header-controls">
                            <div class="status-indicator">
                                <div class="status-dot"></div>
                                <span id="alertsCount">0 alertas</span>
                            </div>
                        </div>
                    </div>
                    <div id="alertsList">
                        <!-- Alerts will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="content-section">
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Análise Angular</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #a55eea, #8854d0);">
                                <i class="fas fa-compass"></i>
                            </div>
                        </div>
                        <div class="card-value" id="angularStrength">0%</div>
                        <div class="card-change" id="angularTrend">
                            <span>Direção: Neutro</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Padrões Detectados</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #ff6348, #ff4757);">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="card-value" id="patternsCount">0</div>
                        <div class="card-change" id="patternsConfidence">
                            <span>Confiança: 0%</span>
                        </div>
                    </div>
                </div>

                <!-- Angular Analysis Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Análise Angular dos Ativos</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="angularChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus">
        <div class="ws-indicator" id="connectionIndicator"></div>
        <span id="connectionText">Conectando...</span>
    </div>

    <script>
        // Global variables
        let priceChart, macdChart, sentimentChart, botPerformanceChart, angularChart;
        let sentimentWS, ohlcvWS, rsiMacdWS;
        let currentData = {};
        let chartPeriod = '1d';

        // API Configuration
        const API_BASE_URL = 'http://localhost:8000/api';
        const WS_BASE_URL = 'ws://localhost:8000/ws';

        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            initializeNavigation();
            loadInitialData();
            connectWebSockets();
            startDataRefresh();
        });

        // Navigation
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Remove active class from all links and sections
                    navLinks.forEach(l => l.classList.remove('active'));
                    sections.forEach(s => s.classList.remove('active'));
                    
                    // Add active class to clicked link
                    link.classList.add('active');
                    
                    // Show corresponding section
                    const sectionId = link.getAttribute('data-section');
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.add('active');
                    }
                });
            });

            // Period buttons
            const periodButtons = document.querySelectorAll('.period-btn');
            periodButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    periodButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    chartPeriod = btn.getAttribute('data-period');
                    loadPriceData(chartPeriod);
                });
            });
        }

        // Initialize Charts
        function initializeCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#a0a6b8' }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#a0a6b8' },
                        grid: { color: '#3a3f4e' }
                    },
                    y: {
                        ticks: { color: '#a0a6b8' },
                        grid: { color: '#3a3f4e' }
                    }
                }
            };

            // Price Chart
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Bitcoin',
                            data: [],
                            borderColor: '#ff8c00',
                            backgroundColor: 'rgba(255, 140, 0, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Gold',
                            data: [],
                            borderColor: '#ffd700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'DXY',
                            data: [],
                            borderColor: '#00cc66',
                            backgroundColor: 'rgba(0, 204, 102, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: chartOptions
            });

            // MACD Chart
            const macdCtx = document.getElementById('macdChart').getContext('2d');
            macdChart = new Chart(macdCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'MACD',
                            data: [],
                            borderColor: '#3742fa',
                            backgroundColor: 'rgba(55, 66, 250, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Signal',
                            data: [],
                            borderColor: '#ff4757',
                            backgroundColor: 'rgba(255, 71, 87, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: chartOptions
            });

            // Sentiment Chart
            const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
            sentimentChart = new Chart(sentimentCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'BTC Buyers %',
                            data: [],
                            borderColor: '#ff8c00',
                            backgroundColor: 'rgba(255, 140, 0, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Fear & Greed',
                            data: [],
                            borderColor: '#ffd700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: chartOptions
            });

            // Bot Performance Chart
            const botCtx = document.getElementById('botPerformanceChart').getContext('2d');
            botPerformanceChart = new Chart(botCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Balance',
                            data: [],
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'PnL',
                            data: [],
                            borderColor: '#3742fa',
                            backgroundColor: 'rgba(55, 66, 250, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: chartOptions
            });

            // Angular Chart
            const angularCtx = document.getElementById('angularChart').getContext('2d');
            angularChart = new Chart(angularCtx, {
                type: 'bar',
                data: {
                    labels: ['BTC', 'Gold', 'DXY'],
                    datasets: [
                        {
                            label: 'Ângulo de Tendência',
                            data: [0, 0, 0],
                            backgroundColor: ['#ff8c00', '#ffd700', '#00cc66'],
                            borderColor: ['#ff6b47', '#ffb347', '#00ff88'],
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    ...chartOptions,
                    scales: {
                        ...chartOptions.scales,
                        y: {
                            ...chartOptions.scales.y,
                            beginAtZero: true,
                            min: -50,
                            max: 50
                        }
                    }
                }
            });
        }

        // WebSocket Connections
        function connectWebSockets() {
            // Sentiment WebSocket
            try {
                sentimentWS = new WebSocket(`${WS_BASE_URL}/sentiment`);
                
                sentimentWS.onopen = () => {
                    console.log('Sentiment WebSocket connected');
                    updateConnectionStatus('sentiment', true);
                };
                
                sentimentWS.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    updateSentimentData(data);
                };
                
                sentimentWS.onclose = () => {
                    console.log('Sentiment WebSocket disconnected');
                    updateConnectionStatus('sentiment', false);
                    setTimeout(() => connectWebSockets(), 5000);
                };
            } catch (error) {
                console.error('Sentiment WebSocket error:', error);
            }

            // OHLCV WebSocket
            try {
                ohlcvWS = new WebSocket(`${WS_BASE_URL}/ohlcv`);
                
                ohlcvWS.onopen = () => {
                    console.log('OHLCV WebSocket connected');
                    updateConnectionStatus('ohlcv', true);
                };
                
                ohlcvWS.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    updateOHLCVData(data);
                };
                
                ohlcvWS.onclose = () => {
                    console.log('OHLCV WebSocket disconnected');
                    updateConnectionStatus('ohlcv', false);
                    setTimeout(() => connectWebSockets(), 5000);
                };
            } catch (error) {
                console.error('OHLCV WebSocket error:', error);
            }

            // RSI MACD WebSocket
            try {
                rsiMacdWS = new WebSocket(`${WS_BASE_URL}/rsi-macd`);
                
                rsiMacdWS.onopen = () => {
                    console.log('RSI MACD WebSocket connected');
                    updateConnectionStatus('rsi_macd', true);
                };
                
                rsiMacdWS.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    updateRSIMACDData(data);
                };
                
                rsiMacdWS.onclose = () => {
                    console.log('RSI MACD WebSocket disconnected');
                    updateConnectionStatus('rsi_macd', false);
                    setTimeout(() => connectWebSockets(), 5000);
                };
            } catch (error) {
                console.error('RSI MACD WebSocket error:', error);
            }
        }

        // Load Initial Data
        async function loadInitialData() {
            try {
                // Load current market data
                const response = await fetch(`${API_BASE_URL}/current`);
                const data = await response.json();
                currentData = data;
                updateMarketData(data);
                
                // Load other data
                await Promise.all([
                    loadBotStatus(),
                    loadSentimentData(),
                    loadEconomicCalendar(),
                    loadAlerts(),
                    loadAngularAnalysis(),
                    loadPriceData(chartPeriod)
                ]);
                
                updateAPIStatus(true);
            } catch (error) {
                console.error('Error loading initial data:', error);
                updateAPIStatus(false);
            }
        }

        // Update Market Data
        function updateMarketData(data) {
            if (!data.assets) return;

            const { btc, gold, dxy } = data.assets;
            
            // Update BTC
            document.getElementById('btcPrice').textContent = `${btc.current_price.toLocaleString()}`;
            updateChangeIndicator('btcChange', btc.change_percent);
            
            // Update Gold
            document.getElementById('goldPrice').textContent = `${gold.current_price.toLocaleString()}`;
            updateChangeIndicator('goldChange', gold.change_percent);
            
            // Update DXY
            document.getElementById('dxyPrice').textContent = dxy.current_price.toFixed(2);
            updateChangeIndicator('dxyChange', dxy.change_percent);
        }

        function updateChangeIndicator(elementId, changePercent) {
            const element = document.getElementById(elementId);
            const isPositive = changePercent >= 0;
            
            element.className = `card-change ${isPositive ? 'change-positive' : 'change-negative'}`;
            element.innerHTML = `
                <i class="fas fa-arrow-${isPositive ? 'up' : 'down'}"></i>
                <span>${isPositive ? '+' : ''}${changePercent.toFixed(2)}%</span>
            `;
        }

        // Load Bot Status
        async function loadBotStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/trading-bot/status`);
                const data = await response.json();
                updateBotStatus(data);
            } catch (error) {
                console.error('Error loading bot status:', error);
            }
        }

        function updateBotStatus(data) {
            // Update bot balance
            document.getElementById('botBalance').textContent = `${data.current_balance?.toLocaleString() || '0'}`;
            document.getElementById('botCurrentBalance').textContent = `${data.current_balance?.toLocaleString() || '0'}`;
            
            // Update PnL
            const pnl = data.total_pnl || 0;
            const pnlElement = document.getElementById('botPnl');
            pnlElement.className = `card-change ${pnl >= 0 ? 'change-positive' : 'change-negative'}`;
            pnlElement.innerHTML = `
                <i class="fas fa-chart-line"></i>
                <span>PnL: ${pnl >= 0 ? '+' : ''}${pnl.toFixed(2)}</span>
            `;
            
            // Update ROI
            document.getElementById('botROI').innerHTML = `
                <span>ROI: ${data.roi_percentage?.toFixed(2) || '0'}%</span>
            `;
            
            // Update trades
            document.getElementById('tradesTotal').textContent = data.total_trades || '0';
            document.getElementById('winRate').innerHTML = `
                <span>Win Rate: ${data.win_rate?.toFixed(1) || '0'}%</span>
            `;
            
            // Update positions
            document.getElementById('activePositions').textContent = data.active_positions_count || '0';
            
            // Update AI accuracy
            document.getElementById('aiAccuracy').textContent = `${data.ai_accuracy?.toFixed(1) || '0'}%`;
            document.getElementById('aiPredictions').innerHTML = `
                <span>Predições: ${data.ai_predictions || '0'}</span>
            `;
            
            // Update bot controls
            const startBtn = document.getElementById('startBotBtn');
            const stopBtn = document.getElementById('stopBotBtn');
            const isRunning = data.status === 'running';
            
            startBtn.disabled = isRunning;
            stopBtn.disabled = !isRunning;
            
            if (isRunning) {
                startBtn.style.display = 'none';
                stopBtn.style.display = 'flex';
            } else {
                startBtn.style.display = 'flex';
                stopBtn.style.display = 'none';
            }
        }

        // Load Sentiment Data
        async function loadSentimentData() {
            try {
                const response = await fetch(`${API_BASE_URL}/sentiment`);
                const data = await response.json();
                updateSentimentDisplay(data);
            } catch (error) {
                console.error('Error loading sentiment data:', error);
            }
        }

        function updateSentimentData(data) {
            updateSentimentDisplay(data);
        }

        function updateSentimentDisplay(data) {
            if (!data) return;
            
            // Update BTC sentiment
            if (data.btc) {
                document.getElementById('btcSentimentValue').textContent = Math.round(data.btc.buyers);
                document.getElementById('btcSentimentTrend').innerHTML = `
                    <span>Tendência: ${data.btc.trend || 'Neutral'}</span>
                `;
            }
            
            // Update Fear & Greed
            if (data.fear_greed_index) {
                document.getElementById('fearGreedValue').textContent = data.fear_greed_index;
                document.getElementById('marketMood').innerHTML = `
                    <span>Humor: ${data.market_mood || 'Neutro'}</span>
                `;
            }
            
            // Update PAXG sentiment
            if (data.paxg) {
                document.getElementById('paxgSentimentValue').textContent = Math.round(data.paxg.buyers);
                document.getElementById('paxgSentimentTrend').innerHTML = `
                    <span>Tendência: ${data.paxg.trend || 'Neutral'}</span>
                `;
            }
        }

        // Load Economic Calendar
        async function loadEconomicCalendar() {
            try {
                const response = await fetch(`${API_BASE_URL}/calendar`);
                const data = await response.json();
                updateEconomicCalendar(data);
            } catch (error) {
                console.error('Error loading economic calendar:', error);
            }
        }

        function updateEconomicCalendar(data) {
            if (!data.summary) return;
            
            document.getElementById('eventsToday').textContent = data.summary.events_today || '0';
            document.getElementById('highImpactToday').innerHTML = `
                <span>Alto Impacto: ${data.summary.high_impact_events || '0'}</span>
            `;
            document.getElementById('upcomingEvents').textContent = data.summary.total_upcoming || '0';
            
            // Update events list
            const eventsContainer = document.getElementById('economicEvents');
            eventsContainer.innerHTML = '';
            
            if (data.upcoming_events && data.upcoming_events.length > 0) {
                data.upcoming_events.slice(0, 10).forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = `alert-item ${event.importance?.toLowerCase() || 'low'}`;
                    eventElement.innerHTML = `
                        <div class="alert-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">${event.name}</div>
                            <div class="alert-message">
                                Impacto: ${event.importance} | 
                                Categoria: ${event.category} | 
                                Score: ${event.impact_score}
                            </div>
                        </div>
                        <div class="alert-time">
                            ${new Date(event.date).toLocaleDateString('pt-BR')}
                        </div>
                    `;
                    eventsContainer.appendChild(eventElement);
                });
            } else {
                eventsContainer.innerHTML = `
                    <div class="alert-item">
                        <div class="alert-content">
                            <div class="alert-title">Nenhum evento encontrado</div>
                            <div class="alert-message">Não há eventos econômicos programados</div>
                        </div>
                    </div>
                `;
            }
        }

        // Load Alerts
        async function loadAlerts() {
            try {
                const response = await fetch(`${API_BASE_URL}/alerts`);
                const data = await response.json();
                updateAlerts(data);
            } catch (error) {
                console.error('Error loading alerts:', error);
            }
        }

        function updateAlerts(data) {
            const alertsContainer = document.getElementById('alertsList');
            const alertsCount = document.getElementById('alertsCount');
            
            alertsCount.textContent = `${data.total_alerts || 0} alertas`;
            alertsContainer.innerHTML = '';
            
            if (data.alerts && data.alerts.length > 0) {
                data.alerts.slice(0, 15).forEach(alert => {
                    const alertElement = document.createElement('div');
                    alertElement.className = `alert-item ${alert.severity?.toLowerCase() || 'low'}`;
                    alertElement.innerHTML = `
                        <div class="alert-icon">
                            <i class="fas fa-${getAlertIcon(alert.type)}"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title || alert.type}</div>
                            <div class="alert-message">${alert.message}</div>
                        </div>
                        <div class="alert-time">
                            ${new Date(alert.timestamp).toLocaleTimeString('pt-BR')}
                        </div>
                    `;
                    alertsContainer.appendChild(alertElement);
                });
            } else {
                alertsContainer.innerHTML = `
                    <div class="alert-item">
                        <div class="alert-content">
                            <div class="alert-title">Nenhum alerta ativo</div>
                            <div class="alert-message">Sistema monitorando mercados...</div>
                        </div>
                    </div>
                `;
            }
        }

        function getAlertIcon(type) {
            const iconMap = {
                'ANGULAR_PATTERN': 'compass',
                'PRE_EVENT_ALERT': 'calendar-exclamation',
                'MACD_CROSSOVER': 'chart-line',
                'SYSTEM': 'cog',
                'default': 'bell'
            };
            return iconMap[type] || iconMap.default;
        }

        // Load Angular Analysis
        async function loadAngularAnalysis() {
            try {
                const response = await fetch(`${API_BASE_URL}/angular`);
                const data = await response.json();
                updateAngularAnalysis(data);
            } catch (error) {
                console.error('Error loading angular analysis:', error);
            }
        }

        function updateAngularAnalysis(data) {
            if (!data.current_angles) return;
            
            const { btc, gold, dxy } = data.current_angles;
            
            // Update cards
            document.getElementById('angularStrength').textContent = `${(data.analysis_summary?.average_strength * 100)?.toFixed(0) || '0'}%`;
            document.getElementById('angularTrend').innerHTML = `
                <span>Direção: ${data.analysis_summary?.market_direction || 'Neutro'}</span>
            `;
            
            document.getElementById('patternsCount').textContent = data.patterns?.total_patterns || '0';
            document.getElementById('patternsConfidence').innerHTML = `
                <span>Confiança: ${((data.patterns?.confidence || 0) * 100).toFixed(0)}%</span>
            `;
            
            // Update angular chart
            if (angularChart) {
                angularChart.data.datasets[0].data = [
                    btc?.angle || 0,
                    gold?.angle || 0,
                    dxy?.angle || 0
                ];
                angularChart.update();
            }
        }

        // Load Price Data
        async function loadPriceData(period) {
            try {
                const response = await fetch(`${API_BASE_URL}/precos/${period}`);
                const data = await response.json();
                updatePriceChart(data);
            } catch (error) {
                console.error('Error loading price data:', error);
            }
        }

        function updatePriceChart(data) {
            if (!data.assets || !priceChart) return;
            
            const labels = data.dates || [];
            const btcData = data.assets.btc?.price_data || [];
            const goldData = data.assets.gold?.price_data || [];
            const dxyData = data.assets.dxy?.price_data || [];
            
            priceChart.data.labels = labels;
            priceChart.data.datasets[0].data = btcData;
            priceChart.data.datasets[1].data = goldData;
            priceChart.data.datasets[2].data = dxyData;
            priceChart.update();
        }

        // Update OHLCV Data
        function updateOHLCVData(data) {
            if (data.type === 'ohlcv_update' && data.macd_data) {
                updateMACDChart(data.macd_data);
            }
        }

        function updateMACDChart(macdData) {
            if (!macdChart || !macdData.macd || !macdData.signal) return;
            
            const labels = macdData.macd.map((_, index) => index);
            
             id="btcChange">
                            <i class="fas fa-arrow-up"></i>
                            <span>0%</span>
                        </div>
                        <div class="realtime-indicator">
                            <div class="realtime-dot"></div>
                            Tempo Real
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Ouro (GOLD)</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #ffd700, #ffb347);">
                                <i class="fas fa-coins"></i>
                            </div>
                        </div>
                        <div class="card-value" id="goldPrice">$0</div>
                        <div class="card-change" id="goldChange">
                            <i class="fas fa-arrow-up"></i>
                            <span>0%</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">DXY Index</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #00cc66, #00ff88);">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="card-value" id="dxyPrice">0</div>
                        <div class="card-change" id="dxyChange">
                            <i class="fas fa-arrow-up"></i>
                            <span>0%</span>
                        </div>
                    </div>

                    <!-- Trading Bot Status Card -->
                    <div class="card bot-status-card">
                        <div class="card-header">
                            <span class="card-title">Trading Bot</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #3742fa, #5352ed);">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                        <div class="card-value" id="botBalance">$0</div>
                        <div class="card-change" id="botPnl">
                            <i class="fas fa-chart-line"></i>
                            <span>PnL: $0</span>
                        </div>
                        <div class="bot-controls">
                            <button class="btn btn-success" id="startBotBtn" onclick="startBot()">
                                <i class="fas fa-play"></i>
                                Iniciar
                            </button>
                            <button class="btn btn-danger" id="stopBotBtn" onclick="stopBot()">
                                <i class="fas fa-stop"></i>
                                Parar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Price Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Preços em Tempo Real</h3>
                        <div class="chart-controls">
                            <button class="period-btn active" data-period="1d">1D</button>
                            <button class="period-btn" data-period="5d">5D</button>
                            <button class="period-btn" data-period="1mo">1M</button>
                            <button class="period-btn" data-period="3mo">3M</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Markets Section -->
            <section id="markets" class="content-section">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Análise MACD & RSI</h3>
                        <div class="realtime-indicator">
                            <div class="realtime-dot"></div>
                            WebSocket Ativo
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="macdChart"></canvas>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">RSI Bitcoin</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);">
                                <i class="fas fa-wave-square"></i>
                            </div>
                        </div>
                        <div class="card-value" id="rsiValue">50</div>
                        <div class="card-change" id="rsiStatus">
                            <span>Neutro</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">MACD Signal</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #4834d4, #686de0);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="macdSignal">0.00</div>
                        <div class="card-change" id="macdStatus">
                            <span>Aguardando...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Trading Bot Section -->
            <section id="bot" class="content-section">
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Saldo Atual</span>
                            <div class="card-icon" style="background: var(--gradient-success);">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="botCurrentBalance">$0</div>
                        <div class="card-change" id="botROI">
                            <span>ROI: 0%</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Trades Hoje</span>
                            <div class="card-icon" style="background: var(--gradient-primary);">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                        </div>
                        <div class="card-value" id="tradesTotal">0</div>
                        <div class="card-change" id="winRate">
                            <span>Win Rate: 0%</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Posições Ativas</span>
                            <div class="card-icon" style="background: var(--gradient-warning);">
                                <i class="fas fa-chart-area"></i>
                            </div>
                        </div>
                        <div class="card-value" id="activePositions">0</div>
                        <div class="card-change" id="positionsPnl">
                            <span>PnL Total: $0</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">IA Accuracy</span>
                            <div class="card-icon" style="background: linear-gradient(135deg, #ff9ff3, #f368e0);">
                                <i class="fas fa-brain"></i>
                            </div>
                        </div>
                        <div class="card-value" id="aiAccuracy">0%</div>
                        <div class="card-change" id="aiPredictions">
                            <span>Predições: 0</span>
                        </div>
                    </div>
                </div>

                <!-- Bot Performance Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Performance do Bot</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="botPerformanceChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Sentiment Section -->
            <section id="sentiment" class="content-section">
                <div class="sentiment-grid">
                    <div class="sentiment-card">
                        <h3>Bitcoin Sentiment</h3>
                        <div class="sentiment-gauge">
                            <div class="gauge-circle">
                                <div class="gauge-inner">
                                    <div class="gauge-value" id="btcSentimentValue">50</div>
                                    <div class="gauge-label">Buyers %</div>
                                </div>
                            </div>
                        </div>
                        <div class="card-change"